---
title: Build reproducible reports
format: html
---

```{r}
#| label: setup
#| include: false
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

# Load packages and read data
library(tidyverse)
mdrd <- readr::read_csv("data/mdrd.csv")
```

Background

From (NIDDK)(https://repository.niddk.nih.gov/studies/mdrd/):

The Modification of Diet in Renal Disease (MDRD) study consisted of two randomized clinical trials that investigated whether protein restriction and control of blood pressure had an effect on the progression of chronic kidney disease (CKD). The study tested two hypotheses---that (1) a reduction in dietary protein and phosphorous intake and (2) the maintenance of blood pressure at a level below that usually recommended safely and effectively delays the progression of CKD.

Our data is from Study 2, which included patients with relatively advanced renal disease (GFR between 13 and 24 ml/min). From (NIDDK)(https://repository.niddk.nih.gov/studies/mdrd/):

In study 2, 255 patients with GFR of 13 to 24 ml/min/1.73 m2 were randomly assigned to the low-protein diet (0.58 g per kilogram per day) or a very-low-protein diet (0.28 g per kilogram per day) with a keto acid-amino acid supplement, and a usual- or a low-blood-pressure group (same values as those in study 1). The length of follow-up varied from 18-to-45-months, with monthly evaluations of the patients. The primary outcome was the change in GFR rate over time.

Treatment groups

The study included four treatment groups:

Low-protein, normal-blood pressure (dietl_normbp)
Low-protein, low-blood pressure (dietl_lowbp)
Very low-protein, normal-blood pressure (dietk_normbp)
Very low-protein, low-blood pressure (dietk_lowbp)


```{r unnamed-chunk-3}
mdrd
```

Results


```{r unnamed-chunk-4}
mdrd_tidy <- mdrd %>%
  pivot_longer(
    cols = starts_with("diet"),
    names_to = "treatment",
    values_to = "value"
  ) %>%
  filter(value == 1) %>%
  select(-value) %>%
  group_by(treatment, ptid) %>%
  summarize(
    gfr_slope = (last(gfr, order_by = months) - first(gfr, order_by = months)) / max(months)
  ) %>% 
  filter(!is.nan(gfr_slope)) %>% 
  ungroup()
```

We computed the change in glomerular filtration rate (GFR) over time for each patient in the trial. This variable ranged from mdrd_tidy$gfr_slope %>% min() %>% round(digits = 2) to mdrd_tidy$gfr_slope %>% max() %>% round(digits = 2) ml/min/1.73 m^2^.


```{r unnamed-chunk-5}
mdrd_tidy %>%  
  ggplot(aes(x = treatment, y = gfr_slope)) + 
  geom_boxplot() +
  labs(
    title = "Change in glomerular filtration rate (GFR) by treatment group",
    x = "Treament group",
    y = "GFR slope",
    caption = "Source: NIDDK"
  )
```


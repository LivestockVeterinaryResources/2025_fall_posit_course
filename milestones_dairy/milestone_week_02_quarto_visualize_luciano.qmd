---
title: Read and Visualize
format: html
embed_resources: true
---

```{r}
#| label: setup
#| include: false
knitr::opts_chunk$set(echo = TRUE)

# Load your packages here

library(tidyverse) #this includes many packages and is the main package used in nearly all data wrangling
library(arrow) #this package handles parquet files
library(skimr) #this is particularly helpful when looking at new data or finding NA values
library(waldo) #we use this to create answer keys for these exercises


```

## Read and Visualize

In this milestone, you'll use ggplot2 to visualize the distribution of age_left for a subset of the data. But before you begin, you'll need to import the animals data set. Unlike with Milestone 1, the animals data set has not been pre-loaded for you to use in R.


## Recreation

### Part 1 - Import

In the code chunk below, use a command from the arrow package to read in the animals data set.

* The animals data set lives in the file `animals.parquet` (think of parquet as just another file extension like .csv, or .doc), which is stored in the `data/intermediate_files` folder in your working directory.  However, this quarto document lives in a folder below the working directory, so when you call the file path you need to use "../" at the beginning of the path to tell it to look for the path beginning one level higher than where this quarto document is stored. 

* Save the data set as an object in your environment named `animals`.


```{r}
#| label: recreation-import
#hint the function to read in a parquet file is the same as the code to read a csv file except replace 'csv' with 'parquet'

animals <- read_parquet("../data/intermediate_files/animals.parquet")

```

### Part 2 - Visualize

Run the code chunk below to see a plot. Your task is to recreate this plot. 


```{r}
#| label: recreate-this
#| message: false

knitr::include_graphics("images/milestone02.png")
```

Use `ggplot()` in the chunk below to re-create the plot above. Before plotting, you will first need to filter your data set to only include observations from cattle where age_left is more than 1 year.


```{r}
#| label: recreation-visualize

animals_filtered <- filter(animals, age_left > 365)

ggplot (data = animals_filtered, mapping = aes(x=age_left)) +
  geom_histogram(color = "red")
  #coord_cartesian(ylim = c(0,2000))
```

This next chunk was just my practice to run it in a more streamlined way (did not create a new dataset in this case)

```{r}
geom_histogram()

animals |> 
  filter(age_left>365) |> 
  ggplot(mapping = aes(x=age_left)) +
  geom_histogram(color = "#7a0019", linewidth = 1 , fill = "#ffcc33")


```




## Extension

Using the code chunk below, investigate a research question about this data, using the visualization skills you learned this week. Some ideas:

1. How does the distribution of age_left differ between breeds? Consider exploring these distributions with other geoms.
2. What relationships do you see between age_left and other variables of interest in the data set?
3. [any other research question of interest]

Alternately, working with a data set of your own, complete the following: 

1. Read in your data
2. Filter your data using a logical test/condition 
3. Graph this data subset using at least one geom 



```{r}
#| label: extension

animals |> 
  filter(age_left>365 & breed != "-") |>
  ggplot(mapping = aes(x=age_left, fill = breed)) +
  geom_histogram()+
  scale_fill_viridis_d()+
  labs(title = "Age left by breed (without breed -)")

animals |> 
  filter(age_left>365 & breed != "-") |> 
  ggplot( mapping = aes(x=age_left, fill = breed)) +
  geom_boxplot(mapping = aes(x=breed, y=age_left))+
  scale_fill_viridis_d()+
  labs(title = "Age left by breed (without breed -) Boxplot")

animals |> 
  filter(age_left>365 & breed != "-") 

  overall_mean <- mean(animals$age_left, na.rm = TRUE)
  overall_median <- median (animals$age_left, na.rm = TRUE )
  
  ggplot(data=animals, mapping = aes(x=breed, y = age_left, fill=breed)) +
  geom_boxplot()+
  geom_hline(yintercept = overall_median, color = "purple", linewidth =1)+
  geom_hline(yintercept = overall_mean, color = "red", linewidth =1)+
  scale_fill_viridis_d()+
  labs(title = "Age left by breed",
       caption = "red line = overall mean; purple line = overall median")
  

animals |> 
  filter(age_left>365 & breed != "_") |> 
  ggplot (mapping = aes(x = age_enrolled, y = age_left))+
  geom_point(mapping = aes(color = breed))

animals |> 
  filter (age_left>365 & breed != "-") |> 
  ggplot (mapping = aes (x = date_birth, y = age_left, color = breed))+
  geom_point()+
  labs(title = "Age left by birth day, grouped by breed"
       )


```

